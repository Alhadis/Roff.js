!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.roff={})}(this,function(t){"use strict";var e={space:" ",dq:'"',sh:"#",Do:"$",aq:"'",pl:"+",sl:"/",eq:"=",at:"@",lB:"[",rs:"\\",rB:"]","a^":"^",ha:"^",ru:"_",ul:"_",ga:"`",ff:"ff",Fi:"ffi",Fl:"ffl",fi:"fi",fl:"fl",lC:"{",ba:"|",or:"|",rC:"}","a~":"~",ti:"~","r!":"¡",ct:"¢",Po:"£",Cs:"¤",Ye:"¥",bb:"¦",sc:"§",ad:"¨",co:"©",Of:"ª",Fo:"«",no:"¬",tno:"¬",rg:"®","a-":"¯",de:"°","+-":"±","t+-":"±",S2:"²",S3:"³",aa:"´",mc:"µ",ps:"¶",pc:"·",ac:"¸",S1:"¹",Om:"º",Fc:"»",14:"¼",12:"½",34:"¾","r?":"¿","`A":"À","'A":"Á","^A":"Â","~A":"Ã",":A":"Ä",oA:"Å",AE:"Æ",",C":"Ç","`E":"È","'E":"É","^E":"Ê",":E":"Ë","`I":"Ì","'I":"Í","^I":"Î",":I":"Ï","-D":"Ð","~N":"Ñ","`O":"Ò","'O":"Ó","^O":"Ô","~O":"Õ",":O":"Ö",mu:"×",tmu:"×","/O":"Ø","`U":"Ù","'U":"Ú","^U":"Û",":U":"Ü","'Y":"Ý",TP:"Þ",ss:"ß","`a":"à","'a":"á","^a":"â","~a":"ã",":a":"ä",oa:"å",ae:"æ",",c":"ç","`e":"è","'e":"é","^e":"ê",":e":"ë","`i":"ì","'i":"í","^i":"î",":i":"ï",Sd:"ð","~n":"ñ","`o":"ò","'o":"ó","^o":"ô","~o":"õ",":o":"ö",di:"÷",tdi:"÷","/o":"ø","`u":"ù","'u":"ú","^u":"û",":u":"ü","'y":"ý",Tp:"þ",":y":"ÿ","'C":"Ć","'c":"ć",".i":"ı",IJ:"Ĳ",ij:"ĳ","/L":"Ł","/l":"ł",OE:"Œ",oe:"œ",vS:"Š",vs:"š",":Y":"Ÿ",vZ:"Ž",vz:"ž",Fn:"ƒ",".j":"ȷ",ah:"ˇ",ab:"˘","a.":"˙",ao:"˚",ho:"˛",'a"':"˝","*A":"Α","*B":"Β","*G":"Γ","*D":"Δ","*E":"Ε","*Z":"Ζ","*Y":"Η","*H":"Θ","*I":"Ι","*K":"Κ","*L":"Λ","*M":"Μ","*N":"Ν","*C":"Ξ","*O":"Ο","*P":"Π","*R":"Ρ","*S":"Σ","*T":"Τ","*U":"Υ","*F":"Φ","*X":"Χ","*Q":"Ψ","*W":"Ω","*a":"α","*b":"β","*g":"γ","*d":"δ","*e":"ε","*z":"ζ","*y":"η","*h":"θ","*i":"ι","*k":"κ","*l":"λ","*m":"μ","*n":"ν","*c":"ξ","*o":"ο","*p":"π","*r":"ρ",ts:"ς","*s":"σ","*t":"τ","*u":"υ","+f":"φ","*x":"χ","*q":"ψ","*w":"ω","+h":"ϑ","*f":"ϕ","+p":"ϖ","+e":"ϵ","-":"‐",hy:"‐",en:"–",em:"—","`":"‘",oq:"‘","'":"’",cq:"’",bq:"‚",lq:"“",rq:"”",Bq:"„",dg:"†",dd:"‡",bu:"•","%0":"‰",fm:"′",sd:"″",fo:"‹",fc:"›",rn:"‾","f/":"⁄",eu:"€",Eu:"€","-h":"ℏ",hbar:"ℏ",Im:"ℑ",wp:"℘",Re:"ℜ",tm:"™",Ah:"ℵ",18:"⅛",38:"⅜",58:"⅝",78:"⅞","<-":"←",ua:"↑",arrowverttp:"↑","->":"→",da:"↓",arrowvertbt:"↓",arrowvertex:"⏐","<>":"↔",va:"↕",CR:"↵",lA:"⇐",uA:"⇑",rA:"⇒",dA:"⇓",hA:"⇔",vA:"⇕",fa:"∀",pd:"∂",te:"∃",es:"∅",gr:"∇",mo:"∈",nm:"∉",st:"∋",product:"∏",coproduct:"∐",sum:"∑","\\-":"−",mi:"−","-+":"∓","**":"∗",sqrt:"√",sr:"√",pt:"∝",if:"∞","/_":"∠",AN:"∧",OR:"∨",ca:"∩",cu:"∪",is:"∫",integral:"∫",tf:"∴","3d":"∴",ap:"∼","|=":"≃","=~":"≅","~~":"≈","~=":"≈","!=":"≠","==":"≡",ne:"≢","<=":"≤",">=":"≥","<<":"≪",">>":"≫",sb:"⊂",sp:"⊃",nb:"⊄",nc:"⊅",ib:"⊆",ip:"⊇","c+":"⊕","c*":"⊗",pp:"⊥",md:"⋅",lc:"⌈",rc:"⌉",lf:"⌊",rf:"⌋",parenlefttp:"⎛",parenleftex:"⎜",parenleftbt:"⎝",parenrighttp:"⎞",parenrightex:"⎟",parenrightbt:"⎠",bracketlefttp:"⎡",bracketleftex:"⎢",bracketleftbt:"⎣",bracketrighttp:"⎤",bracketrightex:"⎥",bracketrightbt:"⎦",lt:"⎧",bracelefttp:"⎧",lk:"⎨",braceleftmid:"⎨",lb:"⎩",braceleftbt:"⎩",bv:"⎪",barex:"⎪",braceex:"⎪",braceleftex:"⎪",bracerightex:"⎪",rt:"⎫",bracerighttp:"⎫",rk:"⎬",bracerightmid:"⎬",rb:"⎭",bracerightbt:"⎭",an:"⎯",br:"│",sq:"□",lz:"◊",ci:"○",lh:"☜",rh:"☞",SP:"♠",CL:"♣",HE:"♥",DI:"♦",OK:"✓",la:"⟨",ra:"⟩",radicalex:"",registerserif:"",copyrightserif:"",trademarkserif:"",apple:""};const s=[0,0,0,0,0,0,0,0,0,1,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,3,5,3,3,3,3,3,3,3,7,3,6,8,3,9,9,9,9,9,9,9,9,9,9,3,3,3,3,3,3,3,10,10,11,12,10,10,10,13,10,10,10,10,10,14,10,10,10,10,10,10,10,15,10,16,10,10,3,3,3,3,4,3,10,10,17,18,10,19,20,21,10,10,22,10,23,24,10,25,10,26,27,28,29,30,31,32,10,10,3,3,3,3,0],i=-2,a=-3,o=-4,r=-5,h=-6,n=-8,f=-10,c=-11,l=-12,d=-13,u=-14,p=-15,m=-18,g=-21,b=-22,x=-23,w=-40,y=-44,S=-48,k=14,C=[[0,0,0,0,0,i,0,0,0,p,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,w,y,u,g,S],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,0,0,0,i,0,0,0,2,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[3,3,0,0,0,i,0,0,0,3,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[4,4,0,0,0,i,0,0,0,4,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[5,5,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[7,7,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],[8,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],[9,9,0,0,0,i,9,0,0,9,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[10,10,0,0,0,i,10,0,10,10,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[11,11,0,0,0,i,11,0,11,11,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[12,12,0,0,0,i,12,0,12,12,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[13,13,0,0,0,i,13,0,13,13,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[k,0,0,0,0,i,0,0,0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[15,0,0,16,16,i,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],[16,0,0,0,0,i,0,0,0,p,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[17,0,0,0,0,i,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[18,19,0,0,0,0,18,0,18,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[19,0,0,0,0,i,19,0,19,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,i,0,0,0,p,0,n,b,c,f,l,0,h,0,r,0,d,0,0,m,a,0,o,0,0,u,g,S],[21,21,0,21,21,i,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21],[22,22,0,0,0,i,0,0,0,0,0,0,0,0,0,0,0,23,27,0,28,0,30,0,0,0,35,0,0,0,0,0,0],[23,23,0,0,0,i,0,0,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[24,25,0,0,0,i,0,0,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[25,26,0,0,0,i,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[26,0,0,0,0,i,0,0,0,26,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,0,0,u,g,S],[0,0,0,0,0,i,0,0,0,0,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,0,0,u,g,S],[28,28,0,0,0,i,0,0,0,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[29,0,0,0,0,i,0,0,0,29,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,0,0,u,g,S],[30,30,0,0,0,i,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[31,32,0,0,0,i,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[32,33,0,0,0,i,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[33,34,0,0,0,i,0,0,0,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[34,0,0,0,0,i,0,0,0,34,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,0,0,u,g,S],[35,35,0,0,0,i,0,0,0,36,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[36,37,0,0,0,i,0,0,0,36,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[37,38,0,0,0,i,0,0,0,37,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[38,0,0,0,0,i,0,0,0,38,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,0,0,u,g,S],[39,39,0,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40],[40,41,0,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40],[41,41,0,0,0,i,42,0,0,42,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,w,0,u,g,S],[42,0,0,0,0,i,42,0,0,42,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,w,0,u,g,S],[43,43,0,0,0,i,44,0,0,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[44,45,0,46,46,46,46,46,46,44,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46],[45,45,0,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46],[46,0,0,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46,46],[47,47,0,48,48,48,48,48,48,48,48,48,48,48,48,48,49,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48],[48,48,0,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48],[49,49,50,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49],[0,0,0,0,0,i,0,49,0,p,0,n,b,c,f,l,0,h,0,r,0,d,0,x,m,a,0,o,w,y,u,g,S]];class L{beginPage(){}handleDeviceControl(){}handleDrawingCommand(){}handleUnknownCommand(){}informEOL(){}informWordSpace(){}moveByX(){}moveByY(){}moveThenPrint(){}moveToX(){}moveToY(){}printChar(){}printText(){}readComment(){}setColour(){}setFont(){}setSize(){}process(t){const e="string"==typeof t;let i="",a=0,o=0;const{length:r}=t;for(let h=0;h<r;++h){const[r,n]=e?[t[h],t.charCodeAt(h)]:[String.fromCharCode(t[h]),t[h]],f=s[n],c=C[o][f];c<0?(this.exec(a,i,h),a=c,i=k===(o=~c)?r:""):0!==(o=c)&&(i+=r)}}exec(t,e,s){switch(this.lastCommand=[t,e,s],t){case g:this.informWordSpace();break;case w:this.printText(e);break;case h:this.printChar(e);break;case i:this.readComment(e);break;case a:this.beginPage(+e);break;case d:this.moveByX(+e);break;case u:this.moveByY(+e);break;case c:this.moveToX(+e);break;case l:this.moveToY(+e);break;case r:this.setFont(+e);break;case o:this.setSize(+e);break;case b:case S:case m:switch(e=e.trim().split(/\s+/),t){case S:this.handleDeviceControl(...e);break;case b:this.handleDrawingCommand(...e);break;case m:this.informEOL(...e.map(t=>+t))}break;case x:const k=e.substr(1).trim().split(/\s+/).map(t=>+t);this.setColour(e[0],k);break;case f:this.printChar(String.fromCharCode(+e));break;case n:this.printChar(this.getCharByName(e));break;case p:const[C,L]=e.replace(/\s+/g,"").split(/(?=.$)/);this.moveThenPrint(+C,L);break;case y:const[,v,N]=e.match(/^(\d+)\s*(.*)$/m);this.printTrackedText(+v,N);break;default:this.handleUnknownCommand(t,e)}}getCharByName(t){if(e[t])return e[t];if(1===t.length)return t;if(/^u(?!0[A-F0-9]{4,})[A-F0-9]{4,}/.test(t)){const t=parseInt(RegExp["$&"].substr(1),16);return t>1114111?"":t>=55296&&t<=56319||t>=56320&&t<=57343?"":String.fromCharCode(t)}if(/^char[0-9]{1,3}$/.test(t)){const e=parseInt(t.substr(4));return e<=255?String.fromCharCode(e):""}return console.warn(`Unrecognised glyph-name: ${t}`),""}}L.tokenTypes={BEGIN_PAGE:a,CHAR_INDEXED:f,CHAR_LITERAL:h,CHAR_NAMED:n,COMMENT:i,DEVICE_CTRL:S,DRAWING:b,INFORM_EOL:m,INFORM_PAD:g,MOVE_ABS_H:c,MOVE_ABS_V:l,MOVE_PRINT:p,MOVE_REL_H:d,MOVE_REL_V:u,SET_COLOUR:x,SET_FONT:r,SET_SIZE:o,TEXT_NORMAL:w,TEXT_TRACKED:y};class v{constructor(t=0,e=0){const s=[[]];let i=-1,a="R",o=0,r=0,h=0,n=0;Object.defineProperties(this,{colour:{get:()=>i,set:t=>i=+t||0},font:{get:()=>a,set:t=>a=String(t||"R")},charAbove:{get:()=>0===r?"":(s[r-1][o]||[""])[0],set:t=>{0!==r&&(s[r-1][o]=[t,this.font,this.colour])}},charBelow:{get:()=>r<h-1?(s[r+1][o]||[""])[0]:"",set:t=>{r===h-1&&++this.rows,s[r+1][o]=[t,this.font,this.colour]}},charBefore:{get:()=>0===o?"":(s[r][o-1]||[""])[0],set:t=>{0!==o&&(this.data[r][o-1]=[t,this.font,this.colour])}},charAfter:{get:()=>o<n-1?(s[r][o+1]||[""])[0]:"",set:t=>{o===n-1&&++this.cols,s[r][o+1]=[t,this.font,this.colour]}},currentChar:{get:()=>{const t=s[r][o];return t&&t[0]||""},set:t=>s[r][o]=[t,this.font,this.colour]},data:{get:()=>s},rows:{get:()=>h,set:t=>{if((t=Math.max(1,+t))>h)for(let e=h;e<t;++e)s.push(new Array(n).fill(" ").map(t=>[t,"R",-1]));else t<h&&(h.length=t);h=t}},cols:{get:()=>n,set:t=>{if((t=Math.max(1,+t))>n)for(const e of s)for(let s=n;s<t;++s)e.push([" ","R",-1]);else if(t<n)for(const e of s)e.length=t;n=t}},x:{get:()=>o,set:t=>{(o=Math.max(0,t))>n&&(this.cols=o)}},y:{get:()=>r,set:t=>{(r=Math.max(0,t))>h&&(this.rows=r)}},width:{get:()=>this.cols,set:t=>this.cols=t},height:{get:()=>this.rows,set:t=>this.rows=t}}),this.cols=t,this.rows=e}drawLine(t,e=0){t=+t||0,e=+e||0;const{x:s,y:i}=this;if(0===e){let e=s,a=Math.max(0,s+t),o=a;a>this.cols?this.cols=a:t<0&&([a,e]=[e,a],o=e);for(let t=e;t<a;++t){this.x=t;const{charAfter:s,charBefore:o,charAbove:r,charBelow:h,currentChar:n}=this;let f="─";if(B(n)||N(n)){const i=N(r),n=B(h);if(t===e){const t=T(o);i?f=t&&n?"┼":t?"┴":n?"├":"└":t&&n?f="┬":n&&(f="┌")}else if(t===a-1){const t=R(s);i?f=t&&n?"┼":t?"┴":n?"┤":"┘":t&&n?f="┬":n&&(f="┐")}else i&&n?f="┼":i?f="┴":n&&(f="┬")}this.data[i][t]=[f,this.font,this.colour]}return this.moveTo(o,i)}if(0===t){let t=i,a=Math.max(0,i+e),o=a;a>this.rows?this.rows=a:e<0&&([a,t]=[t,a],o=t);for(let e=t;e<a;++e){this.y=e;const{charAfter:i,charBefore:o,charAbove:r,charBelow:h,currentChar:n}=this;let f="│";if(R(n)||T(n)){const s=T(o),n=R(i);if(e===t){const t=N(r);s?f=t&&n?"┼":t?"┤":n?"┬":"┐":t&&n?f="├":n&&(f="┌")}else if(e===a-1){const t=B(h);s?f=n&&t?"┼":n?"┴":t?"┤":"┘":n&&t?f="├":n&&(f="└")}else s&&n?f="┼":s?f="┤":n&&(f="├")}this.data[e][s]=[f,this.font,this.colour]}return this.moveTo(s,o)}if(Math.abs(t)===Math.abs(e)){const a=s,o=i,r=Math.max(0,s+t),h=Math.max(0,i+e);let n=1,f=1;r>this.cols?this.cols=r:t<0&&(n=-1),h>this.rows?this.rows=h:e<0&&(f=-1);const c=t<0&&e<0||t>0&&e>0?"╲":"╱",l=Math.abs(t);for(let t=0;t<l;++t){const e=a+t*n,s=o+t*f;if(e<0||s<0)continue;const i=(this.data[s][e]||[""])[0],r="╳"===i||i!==c&&("╲"===i||"╱"===i)?"╳":c;this.data[s][e]=[r,this.font,this.colour]}return this.moveTo(r,h)}return this}draw(t){for(const[e,s]of t)0===e?s<0?this.down().drawLine(0,s-1):this.drawLine(0,s+1).up():0===s?e<0?this.right().drawLine(e-1,0):this.drawLine(e+1,0).left():Math.abs(e)===Math.abs(s)&&(this.drawLine(e,s),s>0&&this.up());return this}box(t,e=0){return t=+t||0,e=+e||t,this.draw([[t,0],[0,e],[-t,0],[0,-e]]).moveBy(t)}polygon(t){const{length:e}=t,s=[],i=t[0];let[a,o]=i;for(let i=1;i<e;++i)s.push([t[i][0]-a,t[i][1]-o]),[a,o]=t[i];return[a,o]=i,s.push([a-t[e-1][0],o-t[e-1][1]]),this.moveTo(a,o).draw(s)}moveBy(t,e){return this.x+=t,this.y+=e,this}moveTo(t,e){return this.x=t,this.y=e,this}left(t=1){return this.x-=t,this}right(t=1){return this.x+=t,this}down(t=1){return this.y+=t,this}up(t=1){return this.y-=t,this}asciify(t="text"){return this.toString(t).replace(/\u{2500}/gu,"-").replace(/\u{2502}/gu,"|").replace(/\u{2571}/gu,"/").replace(/\u{2572}/gu,"\\").replace(/\u{2573}/gu,"X").replace(/[^-|\\X\/\s]/gu,"+")}toString(t="html"){const e="html"===t?M:P;return this.data.map(e).join("\n")}writeRaw(t){if(!t)return this;let e=0;const{length:s}=t;for(let i=0;i<s;++i){const s=t.charCodeAt(i+1)||-1;switch(t.charCodeAt(i)){case 8:this.left();break;case 9:this.x|=7,++this.x;break;case 11:this.up();break;case 13:if(10===s)continue;this.x=0;break;case 10:case 133:this.write("\n");break;case 12:this.down();break;case 14:case 15:break;case 32:this.right();break;case 27:switch(s){case 7:case 55:this.up(),e=0,++i;break;case 8:case 56:++i,-1===(e-=.5)&&(e=0,this.up());break;case 9:case 57:++i,1===(e+=.5)&&(e=0,this.down())}break;default:{const e=this.currentChar;if(e&&/\S/.test(e)){const s=this.data[this.y][this.x][1];"_"===e||"_"===t[i]?(this.font="B"===s||"BI"===s?"BI":"I",this.write("_"===e?t[i]:e),this.font="R"):/\S/.test(t[i])&&t[i]===e?(this.font="I"===s||"BI"===s?"BI":"B",this.write(e),this.font="R"):this.write(t[i])}else this.write(t[i])}}}return this}write(t){if(!t)return this;const{length:e}=t,{font:s,colour:i}=this;for(let a=0;a<e;++a){const e=t[a];"\n"===e?(++this.y,this.x=0):this.data[this.y][this.x++]=[e,s,i]}return this}writeln(t){return this.write(`${t}\n`)}colourByCMYK(t,e,s,i=null){let a,o,r;null===i?(a=255*(1-t),o=255*(1-e),r=255*(1-s)):(a=255*(1-t)*(1-i),o=255*(1-e)*(1-i),r=255*(1-s)*(1-i)),this.colourByRGB(a,o,r)}colourByRGB(t,e,s){const i=[t,e,s].map(t=>(t<10?"0":"")+t.toString(16)).join("");-1===(this.colour=U[0].indexOf(i))&&-1===(this.colour=U[1].indexOf(i))&&(this.colour=-1)}colourByGrey(t){this.colourByRGB(t,t,t)}}function N(t){switch(t){case"│":case"┌":case"┐":case"├":case"┤":case"┬":case"┼":return!0}return!1}function R(t){switch(t){case"─":case"┐":case"┘":case"┤":case"┬":case"┴":case"┼":return!0}return!1}function T(t){switch(t){case"─":case"┌":case"└":case"├":case"┬":case"┴":case"┼":return!0}return!1}function B(t){switch(t){case"│":case"└":case"┘":case"├":case"┤":case"┴":case"┼":return!0}return!1}function P(t){return t.map(t=>t[0]).join("")}function M(t,e=!0){let s,i,a="";const{length:o}=t;for(let e=0;e<o;++e){let r=(s=t[e])[0];switch(r){case"<":r="&lt;";break;case">":r="&gt;";break;case"&":r="&amp;"}0===e?a+=E(s[1],s[2])+r:((i=t[e-1])[1]===s[1]&&i[2]===s[2]||(i[2]===s[2]?a+=A(i[1])+E(s[1]):a+=A(i[1],i[2])+E(s[1],s[2])),a+=r,e===o-1&&(a+=A(s[1],s[2])))}if(a=a.replace(/(<[bu][^>]*>)(\s+)/g,"$2$1").replace(/(\s+)(<\/[bu]>)/g,"$2$1").replace(/ +$/gm,""),e){const t=/(^|\s)(<(b|u)[^>]*>)?([a-z0-9][^\s\/<>"'\\]+)(<\/\3>)?\((\d\w{0,3})\)/g,e=/(^|\s|⟨|&lt;)(https?:\/\/[^\s⟨⟩<>"']+?)($|\s|⟩|&gt;)/gi,s=/(^|\s|⟨|>|&lt;)(\w[-\w.]+@\w[-\w.]+\.[-\w.]+\w)($|\s|⟩|<|&gt;)/gi;a=(a=(a=a.replace(t,(...t)=>{const e=t[1],s=t[2]||"",i=t[4],a=t[5]||"",o=t[6];return`${e}<a href="man://${i}/${o}">${s}${i}${a}(${o})</a>`})).replace(e,(t,e,s,i)=>`${e}<a href="${s}">${s}</a>${i}`)).replace(s,(t,e,s,i)=>`${e}<a href="mailto:${s}">${s}</a>${i}`)}return a}function E(t,e=-1){const s=-1!==e?` data-sgr="${e}" style="color:#${H[e]}"`:"";switch(t){case"B":return`<b${s}>`;case"I":return`<u${s}>`;case"BI":return`<b${s}><u>`;default:return s?`<span${s}>`:""}}function A(t,e=-1){switch(t){case"B":return"</b>";case"I":return"</u>";case"BI":return"</u></b>";default:return-1!==e?"</span>":""}}const I="object"==typeof process&&"darwin"===process.platform,U=[["000000","c23621","25bc24","adad27","492ee1","d338d3","33bbc8","cbcccd","818383","fc391f","31e722","eaec23","5833ff","f935f8","14f0f0","e9ebeb"],["000000","cd0000","00cd00","cdcd00","00ee00","cd00cd","00cdcd","e5e5e5","7f7f7f","ff0000","00ff00","ffff00","5c5cff","ff00ff","00ffff","ffffff"],["000000","00005f","000087","0000af","0000d7","0000ff","005f00","005f5f","005f87","005faf","005fd7","005fff","008700","00875f","008787","0087af","0087d7","0087ff","00af00","00af5f","00af87","00afaf","00afd7","00afff","00d700","00d75f","00d787","00d7af","00d7d7","00d7ff","00ff00","00ff5f","00ff87","00ffaf","00ffd7","00ffff","5f0000","5f005f","5f0087","5f00af","5f00d7","5f00ff","5f5f00","5f5f5f","5f5f87","5f5faf","5f5fd7","5f5fff","5f8700","5f875f","5f8787","5f87af","5f87d7","5f87ff","5faf00","5faf5f","5faf87","5fafaf","5fafd7","5fafff","5fd700","5fd75f","5fd787","5fd7af","5fd7d7","5fd7ff","5fff00","5fff5f","5fff87","5fffaf","5fffd7","5fffff","870000","87005f","870087","8700af","8700d7","8700ff","875f00","875f5f","875f87","875faf","875fd7","875fff","878700","87875f","878787","8787af","8787d7","8787ff","87af00","87af5f","87af87","87afaf","87afd7","87afff","87d700","87d75f","87d787","87d7af","87d7d7","87d7ff","87ff00","87ff5f","87ff87","87ffaf","87ffd7","87ffff","af0000","af005f","af0087","af00af","af00d7","af00ff","af5f00","af5f5f","af5f87","af5faf","af5fd7","af5fff","af8700","af875f","af8787","af87af","af87d7","af87ff","afaf00","afaf5f","afaf87","afafaf","afafd7","afafff","afd700","afd75f","afd787","afd7af","afd7d7","afd7ff","afff00","afff5f","afff87","afffaf","afffd7","afffff","d70000","d7005f","d70087","d700af","d700d7","d700ff","d75f00","d75f5f","d75f87","d75faf","d75fd7","d75fff","d78700","d7875f","d78787","d787af","d787d7","d787ff","d7af00","d7af5f","d7af87","d7afaf","d7afd7","d7afff","d7d700","d7d75f","d7d787","d7d7af","d7d7d7","d7d7ff","d7ff00","d7ff5f","d7ff87","d7ffaf","d7ffd7","d7ffff","ff0000","ff005f","ff0087","ff00af","ff00d7","ff00ff","ff5f00","ff5f5f","ff5f87","ff5faf","ff5fd7","ff5fff","ff8700","ff875f","ff8787","ff87af","ff87d7","ff87ff","ffaf00","ffaf5f","ffaf87","ffafaf","ffafd7","ffafff","ffd700","ffd75f","ffd787","ffd7af","ffd7d7","ffd7ff","ffff00","ffff5f","ffff87","ffffaf","ffffd7","ffffff","080808","121212","1c1c1c","262626","303030","3a3a3a","444444","4e4e4e","585858","626262","6c6c6c","767676","808080","8a8a8a","949494","9e9e9e","a8a8a8","b2b2b2","bcbcbc","c6c6c6","d0d0d0","dadada","e4e4e4","eeeeee"]],H=U[+!I].concat(U[2]);var W={AB:["ITC Avant Garde Gothic, URW Gothic L, URW Gothic, Gothic L, sans-serif","600"],ABI:["ITC Avant Garde Gothic, URW Gothic L, URW Gothic, Gothic L, sans-serif","600","oblique"],AI:["ITC Avant Garde Gothic, URW Gothic L, URW Gothic, Gothic L, sans-serif","oblique"],AR:["ITC Avant Garde Gothic, URW Gothic L, URW Gothic, Gothic L, sans-serif"],BMB:["ITC Bookman, URW Bookman L, URW Bookman, Bookman L, Bookman, serif","600"],BMBI:["ITC Bookman, URW Bookman L, URW Bookman, Bookman L, Bookman, serif","600","oblique"],BMI:["ITC Bookman, URW Bookman L, URW Bookman, Bookman L, Bookman, serif","oblique"],BMR:["ITC Bookman, URW Bookman L, URW Bookman, Bookman L, Bookman, serif"],CB:["Courier, Nimbus Mono PS, Nimbus Mono L, Nimbus Mono, monospace","bold"],CBI:["Courier, Nimbus Mono PS, Nimbus Mono L, Nimbus Mono, monospace","bold","italic"],CI:["Courier, Nimbus Mono PS, Nimbus Mono L, Nimbus Mono, monospace","italic"],CR:["Courier, Nimbus Mono PS, Nimbus Mono L, Nimbus Mono, monospace"],EURO:["FreeEuro, sans-serif"],HB:["Helvetica, Helvetica Neue, Nimbus Sans, Nimbus Sans L, Arial, sans-serif","bold"],HBI:["Helvetica, Helvetica Neue, Nimbus Sans, Nimbus Sans L, Arial, sans-serif","bold","italic"],HI:["Helvetica, Helvetica Neue, Nimbus Sans, Nimbus Sans L, Arial, sans-serif","italic"],HR:["Helvetica, Helvetica Neue, Nimbus Sans, Nimbus Sans L, Arial, sans-serif"],HNB:["Helvetica Narrow, Nimbus Sans Narrow, Arial Narrow, sans-serif","bold"],HNBI:["Helvetica Narrow, Nimbus Sans Narrow, Arial Narrow, sans-serif","bold","italic"],HNI:["Helvetica Narrow, Nimbus Sans Narrow, Arial Narrow, sans-serif","italic"],HNR:["Helvetica Narrow, Nimbus Sans Narrow, Arial Narrow, sans-serif"],NB:["New Century Schoolbook, Century Schoolbook L, C059, Century Schoolbook, serif","bold"],NBI:["New Century Schoolbook, Century Schoolbook L, C059, Century Schoolbook, serif","bold","italic"],NI:["New Century Schoolbook, Century Schoolbook L, C059, Century Schoolbook, serif","italic"],NR:["New Century Schoolbook, Century Schoolbook L, C059, Century Schoolbook, serif"],PB:["Palatino, URW Palladio L, Palladio L, P052, Palatino Linotype, serif","bold"],PBI:["Palatino, URW Palladio L, Palladio L, P052, Palatino Linotype, serif","bold","italic"],PI:["Palatino, URW Palladio L, Palladio L, P052, Palatino Linotype, serif","italic"],PR:["Palatino, URW Palladio L, Palladio L, P052, Palatino Linotype, serif"],S:["Standard Symbols PS, Standard Symbols L, Symbol, serif"],SS:["Standard Symbols PS, Standard Symbols L, Symbol, serif","oblique"],TB:["Times, Nimbus Roman No9 L, Nimbus Roman, serif","bold"],TBI:["Times, Nimbus Roman No9 L, Nimbus Roman, serif","bold","italic"],TI:["Times, Nimbus Roman No9 L, Nimbus Roman, serif","italic"],TR:["Times, Nimbus Roman No9 L, Nimbus Roman, serif"],ZCMI:["ITC Zapf Chancery, Zapf Chancery, Chancery L, URW Chancery L, Z003, cursive","italic"],ZD:["ITC Zapf Dingbats, Zapf Dingbats, D050000L, Dingbats"],"U-AB":["URW Gothic L, URW Gothic, Gothic L, sans-serif","600"],"U-ABI":["URW Gothic L, URW Gothic, Gothic L, sans-serif","600","oblique"],"U-AI":["URW Gothic L, URW Gothic, Gothic L, sans-serif","oblique"],"U-AR":["URW Gothic L, URW Gothic, Gothic L, sans-serif"],"U-BMB":["URW Bookman L, URW Bookman, Bookman L, Bookman, serif","600"],"U-BMBI":["URW Bookman L, URW Bookman, Bookman L, Bookman, serif","600","italic"],"U-BMI":["URW Bookman L, URW Bookman, Bookman L, Bookman, serif","italic"],"U-BMR":["URW Bookman L, URW Bookman, Bookman L, Bookman, serif"],"U-CB":["Nimbus Mono PS, Nimbus Mono L, Nimbus Mono, monospace","bold"],"U-CBI":["Nimbus Mono PS, Nimbus Mono L, Nimbus Mono, monospace","bold","oblique"],"U-CI":["Nimbus Mono PS, Nimbus Mono L, Nimbus Mono, monospace","oblique"],"U-CR":["Nimbus Mono PS, Nimbus Mono L, Nimbus Mono, monospace"],"U-HB":["Nimbus Sans, Nimbus Sans L, Arial, sans-serif","bold"],"U-HBI":["Nimbus Sans, Nimbus Sans L, Arial, sans-serif","bold","italic"],"U-HI":["Nimbus Sans, Nimbus Sans L, Arial, sans-serif","italic"],"U-HR":["Nimbus Sans, Nimbus Sans L, Arial, sans-serif"],"U-HNB":["Nimbus Sans Narrow, Arial Narrow, sans-serif","bold"],"U-HNBI":["Nimbus Sans Narrow, Arial Narrow, sans-serif","bold","oblique"],"U-HNI":["Nimbus Sans Narrow, Arial Narrow, sans-serif","oblique"],"U-HNR":["Nimbus Sans Narrow, Arial Narrow, sans-serif"],"U-NB":["Century Schoolbook L, C059, Century Schoolbook, serif","bold"],"U-NBI":["Century Schoolbook L, C059, Century Schoolbook, serif","bold","italic"],"U-NI":["Century Schoolbook L, C059, Century Schoolbook, serif","italic"],"U-NR":["Century Schoolbook L, C059, Century Schoolbook, serif"],"U-PB":["URW Palladio L, Palladio L, P052, Palatino Linotype, serif","bold"],"U-PBI":["URW Palladio L, Palladio L, P052, Palatino Linotype, serif","bold","italic"],"U-PI":["URW Palladio L, Palladio L, P052, Palatino Linotype, serif","italic"],"U-PR":["URW Palladio L, Palladio L, P052, Palatino Linotype, serif"],"U-S":["Standard Symbols PS, Standard Symbols L, serif"],"U-TB":["Times, Nimbus Roman No9 L, Nimbus Roman, serif","bold"],"U-TBI":["Times, Nimbus Roman No9 L, Nimbus Roman, serif","bold","italic"],"U-TI":["Times, Nimbus Roman No9 L, Nimbus Roman, serif","italic"],"U-TR":["Times, Nimbus Roman No9 L, Nimbus Roman, serif"],"U-ZCMI":["ITC Zapf Chancery, Zapf Chancery, Chancery L, URW Chancery L, Z003, cursive","italic"],"U-ZD":["D050000L, Dingbats"]},$={"S SS":{"∀":34,"∃":36,"∋":39,"∗":42,"−":45,"≅":64,"Α":65,"Β":66,"Χ":67,"Δ":68,"Ε":69,"Φ":70,"Γ":71,"Η":72,"Ι":73,"ϑ":74,"Κ":75,"Λ":76,"Μ":77,"Ν":78,"Ο":79,"Π":80,"Θ":81,"Ρ":82,"Σ":83,"Τ":84,"Υ":85,"ς":86,"Ω":87,"Ξ":88,"Ψ":89,"Ζ":90,"∴":92,"⊥":94,"":96,"α":97,"β":98,"χ":99,"δ":100,"ε":101,"ϕ":102,"γ":103,"η":104,"ι":105,"φ":106,"κ":107,"λ":108,"μ":109,"ν":110,"ο":111,"π":112,"θ":113,"ρ":114,"σ":115,"τ":116,"υ":117,"ϖ":118,"ω":119,"ξ":120,"ψ":121,"ζ":122,"∼":126,"€":160,"ϒ":161,"′":162,"≤":163,"⁄":164,"∞":165,"ƒ":166,"♣":167,"♦":168,"♥":169,"♠":170,"↔":171,"←":172,"↑":173,"→":174,"↓":175,"°":176,"±":177,"″":178,"≥":179,"×":180,"∝":181,"∂":182,"·":183,"÷":184,"≠":185,"≡":186,"≈":187,"…":188,"⏐":189,"⎯":190,"↵":191,"ℵ":192,"ℑ":193,"ℜ":194,"℘":195,"⊗":196,"⊕":197,"∅":198,"∩":199,"∪":200,"⊃":201,"⊇":202,"⊄":203,"⊂":204,"⊆":205,"∈":206,"∉":207,"/_":208,"∇":209,"":210,"":211,"":212,"∏":213,"√":214,"⋅":215,"¬":216,"∧":217,"∨":218,"⇔":219,"⇐":220,"⇑":221,"⇒":222,"⇓":223,"◊":224,"⟨":225,"®":226,"©":227,"™":228,"∑":229,"⎛":230,"⎜":231,"⎝":232,"⎡":233,"⎢":234,"⎣":235,"⎧":236,"⎨":237,"⎩":238,"⎪":239,"⟩":241,"∫":242,"⌠":243,"⎮":244,"⌡":245,"⎞":246,"⎟":247,"⎠":248,"⎤":249,"⎥":250,"⎦":251,"⎫":252,"⎬":253,"⎭":254,"":256}};const{tokenTypes:O}=L;class z extends L{constructor(){super(),this.resetDrawingState(),this.resetOutputProperties(),this.resetFontStyles()}resetDrawingState(){this.devCmds=[],this.charHeight=0,this.charSize=0,this.colour="#000",this.drawColour="#000",this.font=["","px sans-serif"],this.invisible=!1,this.lineWidth=1,this.hotspot=null,this.hotspots=[],this.hotspotHold=!1,this.hotspotWrap=!1,this.reversed=!1,this.rotated=!1,this.slant=0,this.sourceFile="",this.tm=null,this.x=0,this.y=0,this.context&&(this.context.lineCap="round",this.context.lineJoin="round",this.context.moveTo(this.x,this.y))}resetFontStyles(){this.fixKerning=!0,this.fixQuotes=!0,this.fontStyles={...W},this.fonts=[0,0,0,0,0,0,"S","ZD"],this.fonts.forEach((t,e)=>{t&&this.mountFont(e,t)})}resetOutputProperties(){this.autoScale=!0,this.sizeScale=1e3,this.scale=1,this.res=[72e3,1,1],this.pageWidth=612,this.pageHeight=792,this.unitWidth=1e3,this.charMaps={};for(const t in $)t.split(" ").forEach(e=>this.charMaps[e]=$[t])}process(t){this.page=[],this.pages=[this.page],this.buffer=null,this.anchors=new Map,this.bookmarks=[],this.resetDrawingState(),super.process(t),null!==this.buffer&&(this.page.push(...this.buffer),this.buffer=null),this.minPageWidth=this.minPageHeight=Number.MAX_VALUE,this.maxPageWidth=this.maxPageHeight=Number.MIN_VALUE,this.pages.forEach((t,e)=>{t.index=e,t.width||(t.width=this.pageWidth),t.height||(t.height=this.pageHeight),t.width>this.maxPageWidth&&(this.maxPageWidth=t.width),t.width<this.minPageWidth&&(this.minPageWidth=t.width),t.height>this.maxPageHeight&&(this.maxPageHeight=t.height),t.height<this.minPageHeight&&(this.minPageHeight=t.height)}),this.bookmarks=this.resolveOutline(this.bookmarks)}exec(t,e){if(!t)return;const s=t===O.TEXT_NORMAL||t===O.MOVE_ABS_H;if(null!==this.buffer&&!s){if(t===O.INFORM_EOL)this.page.push(...this.buffer);else{const t=this.buffer.map(t=>t[0]===O.TEXT_NORMAL?t[1]:"").join("");this.page.push([O.TEXT_NORMAL,t])}this.buffer=null}switch(t){case O.BEGIN_PAGE:return this.page=[...this.pages[0]],this.page.width=this.pageWidth,this.page.height=this.pageHeight,void(this.pages[e]?this.pages.splice(e,0,this.page):this.pages[e]=this.page);case O.DEVICE_CTRL:if(/^\s*X\S*\s+papersize=(\d+(?:\.\d+)?[icpPm]),(\d+(?:\.\d+)?[icpPm])/.test(e))return this.pageWidth=this.parseLength(RegExp.$1),this.pageHeight=this.parseLength(RegExp.$2),void(this.page&&(this.page.width=this.pageWidth,this.page.height=this.pageHeight));if(e=e.trim().replace(/^X\S*\s+ps:exec\b/,"X ps: exec").replace(/\n\+/g,"\n"),/\[\s*(\S.+)\s+pdfmark\b/.test(e)){if(e=RegExp.lastParen.replace(/(\d{4,6}) u/g,(t,e)=>e/this.sizeScale).replace(/\\\[u00(..)\]/g,(t,e)=>parseInt(e,16)),/^\/Dest\s+\/?(\S+)(.*)\s+\/DEST$/.test(e)){const t=RegExp.$1,e=RegExp.$2.match(/\/View\s+\[\/FitH\s+(-?[\d.]+)\s*\]/)||[0];return void this.anchors.set(t,{page:this.page,offset:+e.pop()})}if(/^\/Dest\s+\/?(\S+)\s+\/Title\s+\((.+)\)\s+\/Level\s+(-?\d+)\s+\/OUT$/.test(e)){const t=Math.abs(RegExp.$3)||1;return void this.bookmarks.push({target:RegExp.$1,title:RegExp.$2,level:t})}}break;case O.TEXT_NORMAL:if(this.fixKerning)return this.buffer=this.buffer||[],void this.buffer.push([t,e]);break;case O.MOVE_ABS_H:if(this.fixKerning&&null!==this.buffer)return void this.buffer.push([t,e])}this.page.push([t,e])}resizeCanvas(){if(!this.autoScale)return;const{width:t,height:e}=this.page,{canvas:s}=this.context,i=window.devicePixelRatio,a=Math.max(screen.availWidth,screen.availHeight)*i,o=e/t;t<e?(this.scale=t*this.unitWidth/a,s.width=a,s.height=a*o):(this.scale=e*this.unitWidth/a,s.width=a*(t/e),s.height=a)}resolveOutline(t){const e=[];let s,i=1;for(const a of t){a.children=[],a.parent=null;const{level:t}=a;if(t>i)a.parent=s,s.children.push(a),i=t;else if(t<i)for(;s;){if(s.level<=t){i=s.level,s.parent?s.parent.children.push(a):e.push(a),a.parent=s.parent;break}s=s.parent}else t>1?((s=s.parent||s).children.push(a),a.parent=s):e.push(a);s=a}return e}render(t,e=null,s=!0){null!==e&&(this.context=e),s&&this.clearPage(),this.resetDrawingState(),this.page=t,this.resizeCanvas();for(const[t,e]of this.page)if(t===O.DEVICE_CTRL)super.exec(t,e);else{if(this.invisible)continue;super.exec(t,e)}}clearPage(){const{canvas:t}=this.context;this.context.clearRect(0,0,t.width,t.height)}drawArc(t){const e=this.x*this.scale,s=this.y*this.scale,i=+t[0],a=+t[1],o=+t[2],r=+t[3],h=i+o,n=a+r,f=h*h+n*n;if(0!==f){const t=.5-(i*h+a*n)/f;let c=i+t*h,l=a+t*n;const d=Math.sqrt(c*c+l*l)/this.scale,u=Math.atan2(-l,-c),p=Math.atan2(a+r-l,i+o-c);c=(e+c)/this.scale,l=(s+l)/this.scale,this.context.beginPath(),this.context.arc(c,l,d,u,p,!0),this.context.stroke()}else this.context.beginPath(),this.context.moveTo(e/this.scale,s/this.scale),this.context.lineTo((h+e)/this.scale,(n+s)/this.scale),this.context.stroke();this.x+=(i+o)/this.scale,this.y+=(a+r)/this.scale}drawCircle(t,e=!1){const s=t/this.scale/2;this.context.beginPath(),this.context.ellipse(this.x+s,this.y,s,s,0,0,2*Math.PI),this.x+=2*s,e?this.fill():this.context.stroke()}drawEllipse(t,e=!1){const s=t[0]/this.scale/2,i=t[1]/this.scale/2;this.context.beginPath(),this.context.ellipse(this.x+s,this.y,s,i,0,0,2*Math.PI),this.x+=2*s,e?this.fill():this.context.stroke()}drawLine(t){this.context.moveTo(this.x,this.y),this.x+=+t[0]/this.scale,this.y+=+t[1]/this.scale,this.context.lineTo(this.x,this.y),this.context.stroke()}drawPolygon(t,e=!1){this.context.beginPath(),this.context.moveTo(this.x,this.y);let s=this.x,i=this.y,a=0,o=0;const{length:r}=t;for(let e=0;e<r;e+=2){const r=t[e]/this.scale,h=t[e+1]/this.scale;a+=r,o+=h,s+=r,i+=h,this.context.lineTo(s,i)}this.x+=a,this.y+=o,this.context.closePath(),e?this.fill():this.context.stroke()}drawSpline(t){this.context.beginPath(),this.context.moveTo(this.x,this.y),this.context.lineTo(this.x+=t[0]/2/this.scale,this.y+=t[1]/2/this.scale);const e=t.length-2;for(let s=0;s<e;s+=2){const e=(t[s]-t[s]/2+t[s+2]/2)/this.scale,i=(t[s+1]-t[s+1]/2+t[s+3]/2)/this.scale;this.context.bezierCurveTo(this.x+2*t[s]/6/this.scale,this.y+2*t[s+1]/6/this.scale,this.x+(t[s]/2+1*t[s+2]/6)/this.scale,this.y+(t[s+1]/2+1*t[s+3]/6)/this.scale,this.x+e,this.y+i),this.x+=e,this.y+=i}this.x+=(t[e]-t[e]/2)/this.scale,this.y+=(t[e+1]-t[e+1]/2)/this.scale,this.context.lineTo(this.x,this.y),this.context.stroke()}fill(){this.context.fillStyle=this.drawColour,this.context.fill(),this.context.fillStyle=this.colour}handleDeviceControl(t,...e){switch(t[0]){case"F":this.sourceFile=e.join(" ");break;case"f":this.mountFont(...e);break;case"H":this.charHeight=+e[0]/this.scale,this.charSize===this.charHeight&&(this.charHeight=0),this.updateTransformMatrix();break;case"r":this.res[0]=+e[0]||0,this.res[1]=+e[1]||0,this.res[2]=+e[2]||0;break;case"S":this.slant=+e[0]||0,this.updateTransformMatrix();break;case"X":this.handleExtendedDeviceControl(...e)}}handleDrawingCommand(t,...e){switch(t[0]){case"~":this.drawSpline(e);break;case"a":this.drawArc(e);break;case"c":this.drawCircle(e[0]);break;case"C":this.drawCircle(e[0],!0);break;case"e":this.drawEllipse(e);break;case"E":this.drawEllipse(e,!0);break;case"l":this.drawLine(e);break;case"p":this.drawPolygon(e);break;case"P":this.drawPolygon(e,!0);break;case"t":this.setLineThickness(e[0]);break;case"F":t.length>1&&e.unshift(t.substr(1));const[s,...i]=e;this.drawColour=this.parseColour(s,i);break;case"f":this.drawColour=e[0]<0||e[0]>1e3?this.context.fillStyle:this.parseColour("G",e)}}handleExtendedDeviceControl(t,...e){let s=!1;switch(t){case"ps:":switch(e[0]){case"invis":this.invisible=!0;break;case"endinvis":this.invisible=!1;break;case"exec":const t=e.join(" ");/exec gsave currentpoint 2 copy translate .+ rotate neg exch neg exch translate/.test(t)?this.setRotation(e[6]):"grestore"===e[1]?this.setRotation(0):/exec \d setline(cap|join)/.test(t)?"cap"===RegExp.lastParen?this.context.lineCap=["butt","round","square"][e[1]]:this.context.lineJoin=["miter","round","bevel"][e[1]]:s=!0;break;default:s=!0}break;case"pdf:":switch(e[0]){case"markstart":this.hotspotStart(e);break;case"markend":this.hotspotEnd();break;case"marksuspend":this.hotspotHold=!0;break;case"markrestart":this.hotspotHold=!1;break;case"xrev":this.reversed=!this.reversed,this.updateTransformMatrix();break;default:s=!0}break;default:s=!0}s&&this.devCmds.push({x:this.x,y:this.y,name:t,args:e})}informEOL(){null!==this.hotspot&&(this.hotspotEnd(),this.hotspotWrap=!0)}hotspotStart(t){this.hotspot=this.parseHotspot(t)}hotspotEnd(){null===this.hotspot||this.hotspotHold||(this.hotspot.width=this.x-this.hotspot.x+this.hotspot.lead,this.hotspots.push(this.hotspot),this.hotspot=null)}mountFont(t,e){const s=this.fontStyles[e];if(!s)return console.warn(`Unrecognised font "${e}" will be rendered as sans-serif`),["","px sans-serif"];const i=s[0],a=s.slice(1).reverse().join(" ");this.fonts[t]=[a?`${a} `:"",`px ${i}`],this.fonts[t].name=e}moveByX(t){this.x+=+t/this.scale}moveByY(t){this.y+=+t/this.scale}moveToX(t){this.x=+t/this.scale}moveToY(t){this.y=+t/this.scale}moveThenPrint(t,e){this.x+=Math.floor(+t/this.res[1])/this.scale,this.print(e)}parseColour(t,e){switch(t[0]){case"c":return`rgb(${(e=e.map(t=>255*(1-Math.round(t/65536)))).join()})`;case"k":const[s,i,a,o]=e.map(t=>Math.round(t/65536));return`rgb(${(e=[255*(1-s)*(1-o),255*(1-i)*(1-o),255*(1-a)*(1-o)]).join()})`;case"r":return`rgb(${(e=e.map(t=>Math.round(t/257))).join()})`;case"G":e=[Math.round(65536*(1-e[0]/1e3))];case"g":return`rgb(${(e=new Array(3).fill(Math.round(e[0]/257))).join()})`;default:return"#000"}}parseHotspot(t){const e=(+t[1]+ +t[3])/this.scale,s=(+t[2]-+t[3])/this.scale,i=+t[3]/this.scale,a=this.x-i,o=this.y-e,r=this.y-s-(this.y-e),h=new G(a,o,0,r,i,t);return h.parseExtraArgs(t.slice(4).join(" ")),h}parseLength(t){const e=t.substr(0,t.length-1);switch(t.substr(-1)){case"i":return parseInt(72*e);case"c":return parseInt(72*e/2.54);case"m":return parseInt(72*e/25.4);case"p":return+e;case"P":return 6*e;case"z":return e/this.unitWidth;default:return NaN}}print(t){if(t=this.remapChars(t),this.context.save(),null!==this.tm){if(this.reversed){t=t.split("").reverse().join("");const{width:e}=this.context.measureText(t);this.context.translate(e,0)}this.context.translate(this.x,this.y),this.context.transform(...this.tm),this.context.translate(-this.x,-this.y)}if(this.context.fillText(t,this.x,this.y),this.context.restore(),!0===this.hotspotWrap&&!this.hotspotHold){const t=this.hotspots[this.hotspots.length-1];t&&this.hotspotStart(t.rawArgs),this.hotspotWrap=!1}}printChar(t){this.print(t)}printText(t){this.print(t),this.x+=this.context.measureText(t).width}printTrackedText(t,e){t/=this.scale;for(const s of e.split("")){const{width:e}=this.context.measureText(s);this.print(s),this.x+=e+t}}remapChars(t){const e=this.charMaps[this.font?this.font.name:"R"];if(e){let s="";const{length:i}=t;for(let a=0;a<i;++a){const i=e[t[a]];s+=i?String.fromCharCode(i):t}return s}return t&&this.fixQuotes?t.replace(/`/g,"‘").replace(/'/g,"’"):t}setColour(t,e){this.colour=this.parseColour(t,e),this.context.fillStyle=this.colour,this.context.strokeStyle=this.colour}setFont(t){this.font=this.fonts[t],this.context.font=this.font[0]+this.charSize+this.font[1]}setLineThickness(t){let e=t/this.scale;e<0&&(e=this.res[0]/(72*this.sizeScale)*40*this.charSize/1e3),this.context.lineWidth=e,this.x+=e}setRotation(t){!(t=+t||0)&&this.rotated?(this.context.restore(),this.rotated=!1):(this.context.save(),this.context.resetTransform(),this.context.translate(this.x,this.y),this.context.rotate(t*Math.PI/180),this.context.translate(-this.x,-this.y),this.rotated=!0)}setSize(t){if(this.charSize=+t/this.scale,this.context.font=this.font[0]+this.charSize+this.font[1],this.lineWidth<1){const t=this.res[0]/(72*this.sizeScale)*40*this.charSize/1e3;this.context.lineWidth=t,this.x+=t}}updateTransformMatrix(){if(this.reversed||0!==this.slant||0!==this.charHeight){this.tm=[1,0,0,1,0,0];const{charHeight:t,charSize:e,slant:s,tm:i}=this;if(0!==t&&(i[3]=t/e),0!==s){let a=-s;0!==t&&(a*=t/e),a=a*Math.PI/180,i[2]=Math.sin(a)/Math.cos(a)}this.reversed&&(i[0]=-i[0])}else this.tm=null}}class G{constructor(t,e,s,i,a=0,o=null){this.x=t,this.y=e,this.width=s,this.height=i,this.lead=a,this.border={cornerRadiusH:0,cornerRadiusV:0,colour:[0,0,0],dashGaps:[],thickness:0},o&&(this.rawArgs=o)}draw(t){this.border.thickness&&(t.save(),t.lineCap="butt",t.lineJoin="miter",t.lineWidth=this.border.thickness,t.setLineDash(this.border.dashGaps),t.strokeStyle=`rgb(${this.border.colour.join(", ")})`,t.strokeRect(this.x,this.y,this.width,this.height),t.restore())}parseExtraArgs(t){(t=t.replace(/\s*\/Border\s+\[([^[\]]+)\s*(?:\[([^\]]+)\]\s*)?\]/,(t,e,s)=>(e=e.trim().split(/\s+/),this.border.cornerRadiusH=+e[0]||0,this.border.cornerRadiusV=+e[1]||0,this.border.thickness=+e[2]||0,s&&(s=s.trim().split(/\s+/).map(t=>+t),this.border.dashGaps=s),"")).replace(/\s*\/Color\s*\[([^\]]+)\]/,(t,e)=>(e=e.trim().split(/\s+/).map(t=>Math.round(255*+t)||0),this.border.colour=e,"")).replace(/\/Subtype\s+\/Link\s+(.+)/,(t,e)=>(/^\/Dest\s+\/(\S+)\s*$/.test(e)?this.targetDest=RegExp.lastParen:/^\s*\/Action\s+<<\s*\/Subtype\s+\/URI/.test(e)&&(this.targetURI=e.match(/\/URI\s+\((\S*)\)\s+>>/)[1]),"")).trim())&&(this.unparsedArgs=t)}}G.prototype.rawArgs=null,G.prototype.unparsedArgs="";const D="object"==typeof process&&"object"==typeof global&&"object"==typeof module&&"object"==typeof module.exports&&"function"==typeof global.require&&"object"==typeof process.versions&&process.versions.node,F=D&&process.versions.electron,_=async t=>{if(D){const{readFile:e}=require("fs");return new Promise((s,i)=>{e(t,"utf8",(t,e)=>t?i(t):s(e))})}return"function"==typeof window.fetch?(await fetch(t)).text():new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=(()=>{4===i.readyState&&(i.status<400?e(i.responseText):s(new Error(`HTTP 1.1/${i.status} ${i.statusText}`)))}),i.onerror=s,i.send()})},j={openExternal:t=>{if(F){const{openExternal:e}=require("shell");return e(t)}}},V=Symbol("TroffViewHotspots"),q=Symbol("TroffViewHotspot"),X=Symbol("TroffViewCanvas"),Y=Symbol("TroffViewContext"),Z=new Set;class K{constructor(t={}){const e=t.parentElement||null;delete t.parentElement,Object.assign(this,t);const{classNames:s}=this;this.root=this.div(s.root),this.zoomLayer=this.div(s.zoomLayer),this.pagesList=this.div(s.pagesList),this.zoomLayer.appendChild(this.pagesList),this.root.appendChild(this.zoomLayer),e&&e.appendChild(this.root),this.renderer=new z,this.fontListener=(()=>this.refresh()),document.fonts.addEventListener("loadingdone",this.fontListener)}div(t={}){const e=document.createElement("div");return"string"==typeof t&&(t={className:t}),Object.assign(e,t||{})}load(t){this.renderer.process(t),this.numPages=this.renderer.pages.length-1,this.refresh()}async loadFile(t){try{return this.load(await _(t))}catch(e){throw console.error(`[TroffCanvasViewer::loadFile] Error loading ${t}`),console.dir(e),e}}refresh(){const{numPages:t}=this;for(let e=0;e<t;++e){const t=this.renderer.pages[e+1];if(!t)return;const s=this.pagesList.children[e],i=s[Y];this.renderer.render(t,i);const a=Math.round(t.width/this.renderer.maxPageWidth*100);s.style.width=`${a/this.spreadSize}%`,this.setHotspots(this.renderer.hotspots,s)}}get pages(){return this.pagesList?Array.from(this.pagesList.children):[]}get numPages(){return this.pagesList?this.pagesList.childElementCount:0}set numPages(t){const e=this.pagesList.children,s=e.length;if((t=Math.max(1,+t||1))>s)for(let e=s;e<t;++e)this.pagesList.appendChild(this.addPage());else if(t<s)for(const s of Array.from(e).slice(t))this.removePage(s)}get spreadSize(){return+this.pagesList.dataset.spreadSize||1}set spreadSize(t){const{dataset:e}=this.pagesList,s=+e.spreadSize||1;(t=Math.max(1,+t||1))!==s&&(t>1?e.spreadSize=t:delete e.spreadSize,this.refresh())}addPage(){if(Z.size){const t=Array.from(Z)[0];return Z.delete(t),t}const t=this.div(this.classNames.page),e=this.div(this.classNames.hotspotList),s=document.createElement("canvas"),i=s.getContext("2d"),a=this.getCanvasSize();return s.width=a,s.height=a,Object.defineProperties(t,{[V]:{value:e},[X]:{value:s},[Y]:{value:i}}),t.appendChild(s),t.appendChild(e),t}removePage(t){t&&this.pagesList.contains(t)&&(this.pagesList.removeChild(t),Z.add(t))}getCanvasSize(){const t=screen.availWidth,e=screen.availHeight,s=window.devicePixelRatio;return Math.max(t,e)*s}setHotspots(t,e){const s=e[V],{children:i}=s,a=i.length,o=t.length;if(o>a)for(let e=a;e<o;++e){const i=t[e],a=this.addHotspot(i);s.appendChild(a)}else if(o<a)for(const t of Array.from(i).slice(o))this.removeHotspot(t);const r=e[Y],{width:h,height:n}=e[X];for(let e=0;e<o;++e){const s=t[e];this.setHotspotBounds(i[e],s,h,n),this.showHotspots&&!s.border.thickness?(s.border.thickness=2,s.draw(r),s.border.thickness=0):s.draw(r)}}addHotspot(t){const e=this.div("troff-view-hotspot");return e[q]=t,e.addEventListener("click",t=>{const s=e[q];if(s)return s.targetURI?j.openExternal(s.targetURI):s.targetDest&&this.goToAnchor(s.targetDest),t.preventDefault(),!1}),e}setHotspotBounds(t,e,s,i){const{style:a}=t;a.left=`${e.x/s*100}%`,a.top=`${e.y/i*100}%`,a.right=`${(s-(e.x+e.width))/s*100}%`,a.bottom=`${(i-(e.y+e.height))/i*100}%`}get page(){return(this.calculateVisibility().map((t,e)=>[e,t]).sort((t,e)=>t[1]>e[1]?-1:t[1]<e[1]?1:t[0]<e[0]?-1:t[0]>e[0]?1:0)[0]||[0])[0]}set page(t){if(!this.pagesList)return;const e=this.pagesList.children,s=e.length;if(t<=0)this.root.scrollTop=0;else{t>=s&&(t=s-1);const i=e[t];if(!i)return;this.root.scrollTop=i.offsetTop}}goToAnchor(t){const{anchors:e}=this.renderer,s=e.get(t);s&&(this.page=s.page.index-1)}calculateVisibility(){const{numPages:t}=this,e=new Array(t),s=this.root.getBoundingClientRect();for(let i=0;i<t;++i){const t=this.pagesList.children[i].getBoundingClientRect(),{top:a,bottom:o,height:r}=t;if(o<s.top||a>s.bottom)e[i]=0;else{let t=0;a<s.top&&(t+=Math.abs(s.top-a)),o>s.bottom&&(t+=Math.abs(s.bottom-o)),e[i]=1-t/r}}return e}}Object.assign(K.prototype,{classNames:{root:"troff-view",zoomLayer:"troff-view-zoom",pagesList:"troff-view-pages",page:"troff-view-page",hotspotList:"troff-view-hotspots",hotspot:"troff-view-hotspot"},showHotspots:!1});class J extends L{reset(){this.fonts=["","","",""],this.res=[240,24,40],this.output="",this.page=null,this.ulMode=0,this.xFraction=0}process(t,e=!1){return this.reset(),e?(this.output=(new v).writeRaw(t).toString(),this.output):(super.process(t),null!==this.page&&(this.output+=this.page.toString().replace(/^ *\n/,""),this.page=null),this.output=this.output.replace(/\s+$/,""),this.output)}beginPage(){let t=null,e=null;null!==this.page&&(this.output+=this.page.toString().replace(/^ *\n/,""),this.output+="\n",t=this.page.font,e=this.page.colour),this.page=new v,null!==t&&(this.page.font=t,this.page.colour=e)}getCharByName(t){switch(t){case"hy":case"-":return"-";case"'":case"`":return t;default:return super.getCharByName(t)}}handleDeviceControl(t,...e){switch(t[0]){case"r":if(+e[0]>1e3)throw new RangeError(["Wrong output resolution for selected device:","\tExpected: ~240",`\tActual:   ${e[0]}`,"Parsing that will murder your computer."].join("\n"));this.res[0]=+e[0]||0,this.res[1]=+e[1]||0,this.res[2]=+e[2]||0;break;case"f":this.fonts[e[0]]=e[1];break;case"u":this.ulMode=+e[0]}}handleDrawingCommand(t,...e){switch(t){case"l":this.page.draw([[+e[0]/this.res[1],+e[1]/this.res[2]]]);break;case"p":{let t=0,s=0;const i=[],{length:a}=e;for(let o=0;o<a;o+=2){const a=+e[o]/this.res[1],r=+e[o+1]/this.res[2];if(0!==a&&0!==r)return;i.push([a,r]),t+=a,s+=r}if(0!==t&&0!==s)return;i.push([-t,-s]),this.page.draw(i);break}}}moveThenPrint(t,e){this.page.x+=Math.floor(t/this.res[1]);const{x:s,y:i}=this.page;this.page.write(e).moveTo(s,i)}moveToX(t){this.page.x=Math.floor(t/this.res[1]),this.xFraction=0}moveToY(t){this.page.y=Math.floor(t/this.res[2])}moveByX(t){const e=Math.floor(this.xFraction+t/this.res[1]),s=this.page.currentChar||" ",{font:i}=this.page;if(e<0||"R"===i&&-1===this.page.colour||("I"===i||"BI"===i)&&0===this.ulMode)this.page.x+=e;else{const t=" "===s;if(t&&1===e)this.page.write(" ");else{let s=t;if(s){const{width:t,y:i}=this.page;for(let e=this.page.x;e<t;++e){const t=this.page.data[i][e];if(t&&t[0]&&" "!==t[0]){s=!1;break}}s?this.page.write(" ".repeat(e)):this.page.x+=e}else this.page.x+=e}}}moveByY(t){this.page.y+=Math.floor(t/this.res[2])}setColour(t,e=[]){switch(t){default:this.page.colour=-1;break;case"c":case"k":e=e.map(t=>Math.round(t/65536)),this.page.colourByCMYK(...e);break;case"r":e=e.map(t=>Math.round(t/257)),this.page.colourByRGB(...e);break;case"g":this.page.colourByGrey(Math.round(e[0]/257))}}setFont(t){this.page.font=this.fonts[t]}printChar(t){const{x:e,y:s}=this.page;this.page.write(t).moveTo(e,s)}printText(t){this.page.write(t)}printTrackedText(t,e){t/=this.res[1],e=e.split("");const s=this.page.x;let i=this.xFraction||0;for(const a of e)this.page.write(a),i+=t+1,this.page.x=s+Math.floor(i),this.xFraction=i%1}}t.Postprocessor=L,t.TextGrid=v,t.TroffCanvasRenderer=z,t.TroffCanvasViewer=K,t.TTYRenderer=J,t.TTYViewer=class{constructor(t=null){this.landmarks=new Map,this.listeners=new Map,this.renderer=new J,t||((t=document.createElement("output")).className="tty-viewer",Object.assign(t.style,{fontSize:this.pointSize,fontFamily:this.fontFamily,lineHeight:this.lineHeight,display:"block",whiteSpace:"pre"})),Object.defineProperties(this,{element:{value:t},elementStyle:{value:window.getComputedStyle(t)}}),t.addEventListener("click",t=>{const e=(t.target||t.currentTarget).closest("a[href]");e&&(t.preventDefault(),this.emit("link",e))})}get content(){return this.element?this.element.innerHTML:""}set content(t){this.element&&t!==this.content&&(this.element.innerHTML=t)}get columns(){return this.element?Math.ceil(this.element.offsetWidth/this.pointSize):"object"==typeof process?process.stdout.columns:80}get rows(){return this.element?Math.ceil(this.element.offsetHeight/this.pointSize):"object"==typeof process?process.stdout.rows:25}get fontFamily(){return this.element?this.elementStyle.fontFamily:"Menlig, monospace"}set fontFamily(t){this.element&&(t=String(t||""))&&(this.elementStyle.fontFamily=t)}get pointSize(){return this.element?parseFloat(this.elementStyle.fontSize):16}set pointSize(t){this.elment&&(t=Math.max(0,parseFloat(t)||0))&&(this.element.style.fontSize=`${t}px`)}get pointSizeInEms(){return this.pointSize/16}set pointSizeInEms(t){t=parseFloat(t)||0,this.pointSize=16*t}get lineHeight(){return this.element?parseFloat(this.elementStyle.lineHeight):1.5}set lineHeight(t){this.element&&(t=parseFloat(t)||0)>=0&&(this.element.style.lineHeight=t)}emit(t,...e){const s=this.listeners.get(t);if(s&&s.length)for(let t=0;t<s.length;++t)"function"==typeof s[t]&&s[t].call(this,...e)}on(t,e){if("function"!=typeof e)throw new TypeError("[TTYViewer::on] Handler is not a function");const s=this.listeners.get(t);Array.isArray(s)?-1===s.indexOf(e)&&s.push(e):this.listeners.set(t,[e])}render(t){t&&(this.content=this.renderer.process(t),this.remapLandmarks(),this.emit("render"))}goToAnchor(t){t instanceof HTMLElement?t.scrollIntoView():(t=this.formatSlug(t),(t=this.headings.get(t))&&this.element.contains(t)&&t.scrollIntoView())}remapLandmarks(t="b",e=!1){this.landmarks.clear();for(const s of this.element.querySelectorAll(t)){if(!this.isValidHeading(s))continue;let t=s.textContent.trim();e||(t=this.formatSlug(t)),this.landmarks.set(t,s)}}formatSlug(t){return(t||"").toString().toLowerCase().replace(/(\w)'(re)(?=\s|$)/g,"$1-are").replace(/(\w)'s(?=\s|$)/g,"$1s").replace(/[^\w$]/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}isValidHeading(t){if(t===this.element.firstChild)return!0;const e=t.textContent;if(!/[A-Z]/.test(e)||/[a-z]/.test(e))return!1;const s=t.previousSibling,i=t.nextSibling;return s&&s.nodeType===Element.TEXT_NODE&&i&&i.nodeType===Element.TEXT_NODE&&s.textContent.match(/(?:^|(?:^|\n)[ \t]*\n)[ \t]*$/)&&i.textContent.match(/^[ \t]*(?:$|\n)/)}},Object.defineProperty(t,"__esModule",{value:!0})});
